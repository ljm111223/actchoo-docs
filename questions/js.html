<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript 问题整理</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.10f4a269.css" as="style"><link rel="preload" href="/assets/js/app.092652d7.js" as="script"><link rel="preload" href="/assets/js/3.0170136f.js" as="script"><link rel="preload" href="/assets/js/1.47899070.js" as="script"><link rel="preload" href="/assets/js/18.b056b744.js" as="script"><link rel="prefetch" href="/assets/js/10.555c709d.js"><link rel="prefetch" href="/assets/js/11.a0212672.js"><link rel="prefetch" href="/assets/js/12.88c4bfbd.js"><link rel="prefetch" href="/assets/js/13.ae320c6e.js"><link rel="prefetch" href="/assets/js/14.13f61b62.js"><link rel="prefetch" href="/assets/js/15.ee4cb273.js"><link rel="prefetch" href="/assets/js/16.e3b150ce.js"><link rel="prefetch" href="/assets/js/17.947cade8.js"><link rel="prefetch" href="/assets/js/19.fc7b0fdc.js"><link rel="prefetch" href="/assets/js/20.d99c46b0.js"><link rel="prefetch" href="/assets/js/21.f963c6cf.js"><link rel="prefetch" href="/assets/js/22.383ed536.js"><link rel="prefetch" href="/assets/js/23.fa5f94ac.js"><link rel="prefetch" href="/assets/js/24.44c0bb2c.js"><link rel="prefetch" href="/assets/js/25.e2e88276.js"><link rel="prefetch" href="/assets/js/26.266c962b.js"><link rel="prefetch" href="/assets/js/4.6103bc6e.js"><link rel="prefetch" href="/assets/js/5.de33c222.js"><link rel="prefetch" href="/assets/js/6.fbbebc1c.js"><link rel="prefetch" href="/assets/js/7.c16c9497.js"><link rel="prefetch" href="/assets/js/8.8750abc2.js"><link rel="prefetch" href="/assets/js/9.42cbcfac.js">
    <link rel="stylesheet" href="/assets/css/0.styles.10f4a269.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-2d5f533b><div data-v-2d5f533b><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-2d5f533b data-v-2d5f533b><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-2d5f533b data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><!---->
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-2d5f533b><header class="navbar" data-v-2d5f533b><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask" data-v-2d5f533b></div> <aside class="sidebar" data-v-2d5f533b><div class="personal-info-wrapper" data-v-ca798c94 data-v-2d5f533b><!----> <!----> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>0</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>2</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <!----> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>问题合集</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/questions/js.html" aria-current="page" class="active sidebar-link">JavaScript 问题整理</a></li><li><a href="/questions/es6.html" class="sidebar-link">ES6-10</a></li><li><a href="/questions/css.html" class="sidebar-link">CSS</a></li><li><a href="/questions/hand-write.html" class="sidebar-link">手撸</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>wiki 合集</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><!---->
            
          <!---->
          2020
        </a></span></div></div> <div data-v-2d5f533b><main class="page"><div class="page-title" style="display:none;"><h1 class="title">JavaScript 问题整理</h1> <div data-v-3b7f5bdf><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="javascript-问题整理"><a href="#javascript-问题整理" class="header-anchor">#</a> JavaScript 问题整理</h1> <p></p><div class="table-of-contents"><ul><li><a href="#类型">类型</a><ul><li><a href="#object-prototype-tostring-call-、-instanceof-以及-array-isarray-判断数组的优劣">Object.prototype.toString.call() 、 instanceof 以及 Array.isArray() 判断数组的优劣</a></li><li><a href="#类数组对象怎么转换成真正的数组">类数组对象怎么转换成真正的数组</a></li><li><a href="#_1-2-3-map-parseint-what-why">['1', '2', '3'].map(parseInt) what &amp; why ?</a></li><li><a href="#_0-1-0-2-0-3">0.1 + 0.2  !== 0.3 ?</a></li><li><a href="#关于-const-和-let-声明的变量不在-window-上">关于 const 和 let 声明的变量不在 window 上</a></li><li><a href="#使用-sort-对数组-3-15-8-29-102-22-进行排序-输出结果">使用 sort() 对数组 [3, 15, 8, 29, 102, 22] 进行排序，输出结果</a></li><li><a href="#代码题-四则运算的类型转换">代码题：四则运算的类型转换</a></li></ul></li><li><a href="#原型">原型</a><ul><li><a href="#es5-es6-的继承除了写法以外还有什么区别">ES5/ES6 的继承除了写法以外还有什么区别？</a></li><li><a href="#call-和-apply-的区别是什么-哪个性能更好一些">call 和 apply 的区别是什么，哪个性能更好一些</a></li><li><a href="#new-操作的过程">new 操作的过程</a></li><li><a href="#代码题-原型基础-类型基础">代码题：原型基础+类型基础</a></li><li><a href="#代码题-构造函数综合考察">代码题：构造函数综合考察</a></li><li><a href="#代码题-自有属性与原型继承属性">代码题：自有属性与原型继承属性</a></li></ul></li><li><a href="#作用域">作用域</a><ul><li><a href="#内存泄漏的原因">内存泄漏的原因</a></li><li><a href="#闭包的应用">闭包的应用</a></li><li><a href="#代码题-闭包-作用域">代码题：闭包 &amp; 作用域</a></li><li><a href="#代码题-闭包内存泄漏问题-thething">代码题：闭包内存泄漏问题 theThing</a></li><li><a href="#闭包经典问题-循环与闭包">闭包经典问题：循环与闭包</a></li><li><a href="#代码题-声明">代码题：声明</a></li><li><a href="#代码题-this">代码题：this</a></li></ul></li><li><a href="#js-api-相关">JS API 相关</a><ul><li><a href="#数组去重的方法">数组去重的方法</a></li></ul></li></ul></div><p></p> <p>[toc]</p> <h2 id="类型"><a href="#类型" class="header-anchor">#</a> 类型</h2> <h3 id="object-prototype-tostring-call-、-instanceof-以及-array-isarray-判断数组的优劣"><a href="#object-prototype-tostring-call-、-instanceof-以及-array-isarray-判断数组的优劣" class="header-anchor">#</a> Object.prototype.toString.call() 、 instanceof 以及 Array.isArray() 判断数组的优劣</h3> <h4 id="object-prototype-tostring-call"><a href="#object-prototype-tostring-call" class="header-anchor">#</a> Object.prototype.toString.call()</h4> <p>每一个继承 <code>Object</code> 的对象都有 <code>toString</code> 方法，如果 <code>toString</code> 方法没有重写的话，会返回 <code>[Object type]</code>，其中 <code>type</code> 为对象的类型。但当除了 <code>Object</code> 类型的对象外，其他类型直接使用 <code>toString</code> 方法时，会直接返回都是内容的字符串，所以我们需要使用 <code>call</code> 或者 <code>apply</code> 方法来改变 <code>toString</code> 方法的执行上下文。
这种方法对于所有基本的数据类型都能进行判断，即使是 <code>null</code> 和 <code>undefined</code>。</p> <h3 id="类数组对象怎么转换成真正的数组"><a href="#类数组对象怎么转换成真正的数组" class="header-anchor">#</a> 类数组对象怎么转换成真正的数组</h3> <h4 id="题目"><a href="#题目" class="header-anchor">#</a> 题目</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arrayLike <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token string">&quot;Daisy&quot;</span><span class="token punctuation">,</span> length<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="答案"><a href="#答案" class="header-anchor">#</a> 答案</h4> <h5 id="_1-array-原型上的-slice-方法"><a href="#_1-array-原型上的-slice-方法" class="header-anchor">#</a> 1. Array 原型上的 slice 方法</h5> <p>这个方法如果不传参数的话会返回原数组的一个拷贝，因此可以用此方法转换类数组到数组：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_2-array-from-方法"><a href="#_2-array-from-方法" class="header-anchor">#</a> 2. Array.from 方法</h5> <h5 id="_3-扩展运算符"><a href="#_3-扩展运算符" class="header-anchor">#</a> 3. 扩展运算符——...</h5> <p>可以把类数组对象转换为数组，前提是<strong>这个类数组对象上部署了遍历器接口</strong>。
在这个例子中，<code>arrayLike</code> 没有部署遍历器接口，所以这条路走不通。但一些对象，比如函数内部的 <code>arguments</code> 变量（它也是类数组对象），就满足条件，可以用这种方法来转换：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'转换后的 arguments 对象：'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">demo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
</code></pre></div><p>转换后的 arguments 对象：<strong>[1, 2, 3, 4]</strong></p> <h3 id="_1-2-3-map-parseint-what-why"><a href="#_1-2-3-map-parseint-what-why" class="header-anchor">#</a> ['1', '2', '3'].map(parseInt) what &amp; why ?</h3> <blockquote><p><a href="https://muyiy.cn/question/js/2.html" target="_blank" rel="noopener noreferrer">第 2 题：’1’, ‘2’, ‘3’.map(parseInt) what &amp; why ? | 木易杨前端进阶<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>第一眼看到这个题目的时候，脑海跳出的答案是 <strong>[1, 2, 3]</strong>，但是<strong>真正的答案是 [1, NaN, NaN]</strong>。<a href="bear://x-callback-url/open-note?id=FF7D18E0-0849-40A6-BC1D-039EA92EF28D-70156-00028F405A7098E8"></a>
首先让我们回顾一下，<code>map</code> 函数的第一个参数 <code>callback</code> ：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> new_array <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">currentValue<span class="token punctuation">[</span><span class="token punctuation">,</span> index<span class="token punctuation">[</span><span class="token punctuation">,</span> array<span class="token punctuation">]</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// Return element for new_array </span>
	<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">,</span> thisArg<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>这个 <code>callback</code> 一共可以接收三个参数，其中第一个参数代表当前被处理的元素，而第二个参数代表该元素的索引。</p> <p>而 <code>parseInt</code> 则是用来解析字符串的，使字符串成为指定基数的整数 <code>parseInt(string, radix)</code></p> <p>接收两个参数，第一个表示被处理的值（字符串），第二个表示为解析时的基数。</p> <p>了解这两个函数后，我们可以模拟一下运行情况：</p> <ol><li><code>parseInt('1', 0)</code> radix 为 0 时，且 string 参数不以“0x”和“0”开头时，按照 10 为基数处理。这个时候返回 1</li> <li><code>parseInt('2', 1)</code> 基数为 1（1 进制）表示的数中，最大值小于 2，所以无法解析，返回 NaN</li> <li><code>parseInt('3', 2)</code> 基数为 2（2 进制）表示的数中，最大值小于 3，所以无法解析，返回 NaN</li></ol> <p><code>map</code> 函数返回的是一个数组，所以最后结果为<code>[1, NaN, NaN]</code></p> <h3 id="_0-1-0-2-0-3"><a href="#_0-1-0-2-0-3" class="header-anchor">#</a> 0.1 + 0.2  !== 0.3 ?</h3> <p>​	Javascript 中的 Number 类型就是浮点型，而浮点数采用的是 IEEE-754 格式的规定，这是一种二进制表示法，可以精确表示分数，比如 1/2，1/8， 1/1024，每个浮点数占 64 位。</p> <p>但是<strong>二进制浮点数表示法并不能精确的表示类似 0.1 这样的数字</strong>，而被表示为 0.0011001100110011... ，而对于 <code>0.1 + 0.2</code> 这样的运算，操作数会先被转成二进制，然后再计算。</p> <h3 id="关于-const-和-let-声明的变量不在-window-上"><a href="#关于-const-和-let-声明的变量不在-window-上" class="header-anchor">#</a> 关于 const 和 let 声明的变量不在 window 上</h3> <p>在ES5中，<strong>顶层对象的属性和全局变量是等价的</strong>，var 命令和 function 命令声明的全局变量，自然也是顶层对象。</p> <p>但ES6规定，var 命令和 function 命令声明的全局变量，依旧是顶层对象的属性，但 let命令、const命令、class命令声明的全局变量，<strong>不属于顶层对象的属性</strong>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> aa <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bb <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>aa<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>bb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre></div><p>如果打开浏览器控制台就可以看见，在全局作用域中，用 let 和 const 声明的全局变量并没有在全局对象（Global）中，只是一个块级作用域（Script）中。</p> <h3 id="使用-sort-对数组-3-15-8-29-102-22-进行排序-输出结果"><a href="#使用-sort-对数组-3-15-8-29-102-22-进行排序-输出结果" class="header-anchor">#</a> 使用 sort() 对数组 [3, 15, 8, 29, 102, 22] 进行排序，输出结果</h3> <p><code>sort</code> 函数，可以接收一个函数，返回值是比较两个数的相对顺序的值</p> <ol><li><strong>默认没有函数是按照 UTF-16 排序的</strong>，对于字母数字 可以利用 ASCII 进行记忆</li> <li><strong>自定义函数</strong>，接受两个参数做比较，返回值大于 0 则交换位置</li></ol> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [102, 15, 22, 29, 3, 8]</span>
</code></pre></div><h3 id="代码题-四则运算的类型转换"><a href="#代码题-四则运算的类型转换" class="header-anchor">#</a> 代码题：四则运算的类型转换</h3> <p>输出以下代码运行结果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1</span> <span class="token operator">+</span> <span class="token string">&quot;1&quot;</span>
<span class="token number">2</span> <span class="token operator">*</span> <span class="token string">&quot;2&quot;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token string">&quot;a&quot;</span> <span class="token operator">+</span> <span class="token operator">+</span> <span class="token string">&quot;b&quot;</span>
</code></pre></div><h4 id="答案-2"><a href="#答案-2" class="header-anchor">#</a> 答案</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1</span> <span class="token operator">+</span> <span class="token string">&quot;1&quot;</span><span class="token comment">// “11”</span>
<span class="token number">2</span> <span class="token operator">*</span> <span class="token string">&quot;2&quot;</span><span class="token comment">// 4</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// “1,22,1”</span>
“a” <span class="token operator">+</span> <span class="token operator">+</span> “b” <span class="token comment">// “aNaN”</span>
</code></pre></div><h4 id="解析"><a href="#解析" class="header-anchor">#</a> 解析</h4> <h5 id="_1-1-11"><a href="#_1-1-11" class="header-anchor">#</a> 1 + “1” -&gt; &quot;11&quot;</h5> <p>加性操作符：如果只有一个操作数是字符串，则将另一个操作数转换为字符串，然后再将两个字符串拼接起来
所以值为：“11”</p> <h5 id="_2-2-4"><a href="#_2-2-4" class="header-anchor">#</a> 2 * “2” -&gt; 4</h5> <p>乘性操作符：如果有一个操作数不是数值，则在后台调用 <code>Number()</code>将其转换为数值</p> <h5 id="_1-2-2-1-1-22-1"><a href="#_1-2-2-1-1-22-1" class="header-anchor">#</a> [1, 2] + [2, 1] -&gt; &quot;1,22,1&quot;</h5> <p>Javascript 中所有对象基本都是先调用<code>valueOf</code> 方法，如果不是数值，再调用<code>toString</code> 方法。
所以两个数组对象的 <code>toString</code> 方法相加，值为：<code>&quot;1,22,1&quot;</code></p> <h5 id="a-b-anan"><a href="#a-b-anan" class="header-anchor">#</a> “a” + + “b” -&gt; &quot;aNaN&quot;</h5> <p>后边的 <code>+</code> 将作为一元操作符，如果操作数是字符串，将调用 <code>Number</code> 方法将该操作数转为数值，如果操作数无法转为数值，则为 <code>NaN</code>。
所以值为：<code>&quot;aNaN&quot;</code></p> <h2 id="原型"><a href="#原型" class="header-anchor">#</a> 原型</h2> <h3 id="es5-es6-的继承除了写法以外还有什么区别"><a href="#es5-es6-的继承除了写法以外还有什么区别" class="header-anchor">#</a> ES5/ES6 的继承除了写法以外还有什么区别？</h3> <blockquote><p>类和原型的区别</p></blockquote> <h4 id="答案-3"><a href="#答案-3" class="header-anchor">#</a> 答案</h4> <ol><li><code>class</code> 声明子类可以直接通过 <code>__proto__</code> 寻址到父类,而通过 ES5 的方式，<code>Sub.__proto__ === Function.prototype</code></li> <li><code>class</code> 声明会提升，但不会初始化赋值。<code>Foo</code> 进入暂时性死区，类似于 <code>let</code>、<code>const</code> 声明变量。</li> <li><code>class</code> 声明内部会启用严格模式。</li> <li><code>class</code> 的所有方法（包括静态方法和实例方法）都是不可枚举的。</li> <li><code>class</code> 的所有方法（包括静态方法和实例方法）都没有原型对象<code>prototype</code>，所以也没有<code>[[construct]]</code>，不能使用 <code>new</code> 来调用。</li> <li>必须使用 <code>new</code> 调用 <code>class</code>。</li> <li><code>class</code> 内部无法重写类名。</li></ol> <h4 id="解析-2"><a href="#解析-2" class="header-anchor">#</a> 解析</h4> <ol><li><code>class</code> 声明子类可以直接通过 <code>__proto__</code> 寻址到父类,而通过 ES5 的方式，<code>Sub.__proto__ === Function.prototype</code></li></ol> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// ES6 class</span>
<span class="token keyword">class</span> <span class="token class-name">Super</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Sub</span> <span class="token keyword">extends</span> <span class="token class-name">Super</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> sub <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Sub<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> Super<span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// ES5</span>
<span class="token keyword">function</span> <span class="token function">Super</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Sub</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Sub</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Sub<span class="token punctuation">;</span>
<span class="token keyword">var</span> sub <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Sub<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// true</span>

</code></pre></div><ol start="2"><li><code>class</code> 声明会提升，但不会初始化赋值。<code>Foo</code> 进入暂时性死区，类似于 <code>let</code>、<code>const</code> 声明变量。</li></ol> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// it's ok</span>
<span class="token keyword">function</span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: Foo is not defined</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><ol start="3"><li><code>class</code> 声明内部会启用严格模式。</li></ol> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 引用一个未声明的变量</span>
<span class="token keyword">function</span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  baz <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span> <span class="token comment">// it's ok</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fol <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: fol is not defined</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><ol start="4"><li><code>class</code> 的所有方法（包括静态方法和实例方法）都是不可枚举的。</li></ol> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 引用一个未声明的变量</span>
<span class="token keyword">function</span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Bar<span class="token punctuation">.</span><span class="token function-variable function">answer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">print</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> barKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>Bar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['answer']</span>
<span class="token keyword">const</span> barProtoKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['print']</span>

<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token function">answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> fooKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// []</span>
<span class="token keyword">const</span> fooProtoKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// []</span>

</code></pre></div><ol start="5"><li><p><code>class</code> 的所有方法（包括静态方法和实例方法）都没有原型对象<code>prototype</code>，所以也没有<code>[[construct]]</code>，不能使用 <code>new</code> 来调用。</p></li> <li><p>必须使用 <code>new</code> 调用 <code>class</code>。</p></li> <li><p><code>class</code> 内部无法重写类名。</p></li></ol> <h3 id="call-和-apply-的区别是什么-哪个性能更好一些"><a href="#call-和-apply-的区别是什么-哪个性能更好一些" class="header-anchor">#</a> call 和 apply 的区别是什么，哪个性能更好一些</h3> <p><code>Function.prototype.apply</code> 和 <code>Function.prototype.call</code> 的作用是一样的（<em>给函数传参</em>、<em>扩充作用域</em>），区别在于传入参数的不同：</p> <ol><li>第一个参数都是指定函数体内 <code>this</code> 的指向</li> <li>第二个参数开始不同
<ul><li><code>apply</code> 是传入数组或者类数组，<code>apply</code> 把它传给函数作为参数</li> <li><code>call</code> 从第二个开始传入的参数是不固定的，都会传给函数作为参数</li></ul></li> <li><code>call</code> 的性能优于 <code>apply</code>，个人理解是内部少了一次将 <code>apply</code> 第二个参数解构的操作</li></ol> <h3 id="new-操作的过程"><a href="#new-操作的过程" class="header-anchor">#</a> new 操作的过程</h3> <ol><li><strong>新生成一个对象</strong>，为这个新的对象开辟一块属于它的内存空间</li> <li><strong>绑定 this</strong>，把函数体内的 this 指到新开辟的内存空间去</li> <li><strong>链接到原型</strong>，将新对象的 <code>__proto__</code> 这个属性指向对应构造函数的 <code>prototype</code> 属性，把实例和原型对象关联起来</li> <li><strong>返回新对象</strong>，执行函数体内的逻辑，最后即便你没有手动 <code>return</code>，构造函数也会帮你把创建的这个新对象 <code>return</code> 出来</li></ol> <h4 id="代码演示"><a href="#代码演示" class="header-anchor">#</a> 代码演示</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">newFunc</span><span class="token punctuation">(</span><span class="token parameter">father<span class="token punctuation">,</span> <span class="token operator">...</span>rest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 1. 创建一个空对象</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
	<span class="token comment">// 2. 将空对象的原型指定为传入的对象的 prototype</span>
  result<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> father<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
	<span class="token comment">// 3. 将 this 指向空对象</span>
  <span class="token keyword">var</span> result2 <span class="token operator">=</span> <span class="token function">father</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> rest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 4. 返回新对象</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token keyword">typeof</span> result2 <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> result2 <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    result2 <span class="token operator">!==</span> <span class="token keyword">null</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> result2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="代码题-原型基础-类型基础"><a href="#代码题-原型基础-类型基础" class="header-anchor">#</a> 代码题：原型基础+类型基础</h3> <blockquote><p>原型基础 + 类型</p></blockquote> <h4 id="代码"><a href="#代码" class="header-anchor">#</a> 代码</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">var</span> <span class="token function-variable function">A</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">A</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
  n<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  m<span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="答案-4"><a href="#答案-4" class="header-anchor">#</a> 答案</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token number">1</span> <span class="token keyword">undefined</span> <span class="token number">2</span> <span class="token number">3</span>
</code></pre></div><h4 id="解析-3"><a href="#解析-3" class="header-anchor">#</a> 解析</h4> <p><strong>Step1：明确原型关系：</strong></p> <p>b 实例与 A 之间的关系：</p> <p><img src="docs/public/5e7c167b0001cce611460588.png" alt=""></p> <p>c 实例与 A 之间的关系：</p> <p><img src="docs/public/5e7c16840001eace11440602.png" alt=""></p> <p><strong>Step2：关键思路解析 - 构造函数的工作机理</strong></p> <p>相信很多同学对 c 实例没有疑问，更多是疑惑 b 实例为什么明明和 c 实例继承自一个原型，却有着不同的表现。</p> <p>这里需要大家注意一个知识点：当我们用 <code>new</code> 去创建一个实例时，<code>new</code> 做了什么？它做了这四件事：</p> <ul><li>为这个新的对象开辟一块属于它的内存空间</li> <li><strong>把函数体内的 this 指到 1 中开辟的内存空间去</strong></li> <li><strong>将新对象的</strong> <strong>_</strong> <strong>proto_</strong> <strong>这个属性指向对应构造函数的 prototype 属性，把实例和原型对象关联起来</strong></li> <li>执行函数体内的逻辑，最后即便你没有手动 <code>return</code>，构造函数也会帮你把创建的这个新对象 <code>return</code> 出来</li></ul> <p>注意第二步哦，第二步执行完之后，实例对象的原型就把构造函数的 <code>prototype</code> 的引用给存下来了。那么在 b 实例创建的时候，构造函数的 <code>prototype</code> 是啥呢？就是这么个对象：</p> <img src="docs/public/5e7c168f0001c46010580328.png" alt="as" style="zoom:50%;"> <p>所以 b 实例输出的 n 就是 1；同时由于它没有 m 属性，直接输出 <code>undefined</code>。</p> <p>有同学会说了，可是后面我们还对 A 的 <code>prototype</code> 做了修改啊！b 如果存的是引用，它应该感知到我这个修改啊！注意你修改 A 的 <code>prototype</code> 的形式：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token class-name">A</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span> 
	n<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
	m<span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这严格意义上来说不算修改，而是一个重新赋值操作。这个动作的本质是把 A 的 <code>prototype</code> 指向了一个全新的对象：</p> <p><img src="docs/public/5e7c169b0001a45c13680860.png" alt=""></p> <p>从图中我们可以看出，A 单方面切断了和旧 <code>prototype</code> 的关系，而 b 却仍然保留着旧 <code>prototype</code> 的引用。这就是造成 b 实例和 c 实例之间表现差异的原因。</p> <h3 id="代码题-构造函数综合考察"><a href="#代码题-构造函数综合考察" class="header-anchor">#</a> 代码题：构造函数综合考察</h3> <h4 id="代码-2"><a href="#代码-2" class="header-anchor">#</a> 代码</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token constant">C</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">B</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">C</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h4 id="答案-5"><a href="#答案-5" class="header-anchor">#</a> 答案</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre></div><h4 id="解析-4"><a href="#解析-4" class="header-anchor">#</a> 解析</h4> <p><strong>Step1 画出原型链图</strong></p> <p>这道题所涉及的原型关系比较简单，整体虽具有综合性、却不是一道难题，非常适合用来练手，验证各位对命题点一的理解是否到位。这里建议大家动手做，模仿我前面给出的两张原型关系、画一张自己的原型图。</p> <p><strong>Step2 构造函数的工作机理</strong></p> <p>结合我们前面对构造函数的分析，当我们像这样通过 <code>new</code> + 构造函数创建新对象的时候：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token constant">C</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><p>实际上发生了四件事情：</p> <ol><li>为 <code>c</code> 实例开辟一块属于它的内存空间</li> <li>把函数体内的 this 指到 1 中开辟的内存空间去</li> <li>将实例 c 的 <code>_ proto_</code> 这个属性指向构造函数 <code>C</code> 的 <code>prototype</code> 属性</li> <li>执行函数体内的逻辑，最后构造函数会帮你把创建的这个 <code>c</code> 实例 <code>return</code> 出来</li></ol> <p>我们基于这个结论来看 <code>console</code> 中的三次调用：</p> <ul><li><strong><code>new A ().a</code></strong>：构造函数逻辑为空，返回的实例对象 <code>_proto_</code>中包含了 <code>a = 1</code>这个属性。<code>new A ().a</code> 时，发现实例对象本身没有 <code>a</code>，于是沿着原型链找到了原型中的 <code>a</code>，输出其值为 1。</li> <li><strong><code>new B ().a</code></strong>：构造函数中会无条件为实例对象创建一个自有属性 <code>a</code>，这个 <code>a</code> 的值以入参为准。这里我们的入参是 <code>undefined</code>，所以 <code>a</code> 值也是 <code>undefined</code>。</li> <li><strong><code>new C (2).a</code></strong>：构造函数中会有条件地为实例对象创建一个自有属性 <code>a</code>—— 若确实存在一个布尔判定不为 <code>false</code> 的入参 <code>a</code>，那么为实例对象创建对应的 <code>a</code> 值；否则，不做任何事情。这里我们传入了 2，因此实例输出的 <code>a</code> 值就是 2。</li></ul> <h3 id="代码题-自有属性与原型继承属性"><a href="#代码题-自有属性与原型继承属性" class="header-anchor">#</a> 代码题：自有属性与原型继承属性</h3> <p>原型链查找行为当且仅当我们在进行 “读” 操作时会发生</p> <h4 id="代码-3"><a href="#代码-3" class="header-anchor">#</a> 代码</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'a'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">]</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   
 <span class="token punctuation">}</span>
 <span class="token class-name">B</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">var</span> b1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">var</span> b2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
 b1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'change'</span>
 b1<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b2<span class="token punctuation">.</span>name<span class="token punctuation">)</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b2<span class="token punctuation">.</span>color<span class="token punctuation">)</span> 
</code></pre></div><h4 id="答案-6"><a href="#答案-6" class="header-anchor">#</a> 答案</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b2<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'a'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b2<span class="token punctuation">.</span>color<span class="token punctuation">)</span> <span class="token comment">// [&quot;green&quot;, &quot;yellow&quot;, &quot;black&quot;]</span>
</code></pre></div><h4 id="解析-5"><a href="#解析-5" class="header-anchor">#</a> 解析</h4> <p><strong>Step1：画出原型链图</strong></p> <p>这道题有一个迷惑你的地方，就是没有直接用 <code>A</code> 去 <code>new</code> 对象，而是找了一个 “中间人” B，这样就达到了把原型链复杂化的目的。不过问题不大，咱们图照画：</p> <p><img src="docs/public/5f02f37d00016be612100458.png" alt=""></p> <p><strong>Step2：读操作与写操作的区别</strong></p> <p>这里呢，大家看到 <code>b1</code> 和 <code>b2</code> 之间的一个区别就是 <code>b1</code> 有自有的 <code>name</code> 属性。有的同学可能会迷惑，这一行代码：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code>b1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'change'</span>
</code></pre></div><p>在查找 <code>b1</code> 的 <code>name</code> 属性时，难道不应该沿着原型链去找，然后定位并修改原型链上的 <code>name</code> 吗？</p> <p>实际上，这个 “逆流而上” 的变量定位过程，当且仅当我们在进行 “读” 操作时会发生。</p> <p>楼上这行代码，是一个赋值动作，是一个 “写” 操作。在写属性的过程中，如果发现 <code>name</code> 这个属性在 <code>b1</code> 上还没有，那么就会原地为 <code>b1</code> 创建这个新属性，而不会去打扰原型链了。</p> <p>那么 <code>color</code> 这个属性，看上去也像是一个 “写” 操作，为什么它没有给 <code>b2</code> 新增属性、而是去修改了原型链上的 <code>color</code> 呢？首先，这样的写法：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code>b1<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">)</span>
</code></pre></div><p>包括这样的写法（修改对象的属性值）：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code>b1<span class="token punctuation">.</span>color<span class="token punctuation">.</span>attribute <span class="token operator">=</span> <span class="token string">'xxx'</span>
</code></pre></div><p>它实际上并没有改变对象的引用，而仅仅是在原有对象的基础上修改了它的内容而已。像这种不触发引用指向改变的操作，它走的就是 <strong>原型链</strong> <strong>查询 + 修改</strong> 的流程，而非原地创建新属性的流程。</p> <p>如何把它变成写操作呢？直接赋值：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code>b1<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'newColor'</span><span class="token punctuation">]</span>
</code></pre></div><p>这样一来，<code>color</code> 就会变成 <code>b1</code> 的一个自有属性了。 因为 <code>[‘newColor’]</code> 是一个全新的数组，它对应着一个全新的引用。对 js 来说，这才是真正地在向 <code>b1</code> “写入” 一个新的属性。</p> <h2 id="作用域"><a href="#作用域" class="header-anchor">#</a> 作用域</h2> <h3 id="内存泄漏的原因"><a href="#内存泄漏的原因" class="header-anchor">#</a> 内存泄漏的原因</h3> <h5 id="手滑-导致的全局变量"><a href="#手滑-导致的全局变量" class="header-anchor">#</a> “手滑” 导致的全局变量</h5> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
	me <span class="token operator">=</span> <span class="token string">'xiuyan'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当你在非严格模式下写代码时，<code>me</code> 而非 <code>var me</code> 这种写法，会导致这个 <code>me</code> 被默默地挂载到全局对象上。</p> <p>根据我们前面所讲的垃圾回收策略，本来 <code>me</code> 这个变量，如果被 <code>var</code> 声明过，它作为函数作用域内的变量，在函数调用结束后就会消失 —— 这也是我们所期望的。但现在它是一个全局变量了，永远无法被清除。这样的变量一多，问题就来了。</p> <h5 id="忘记清除的-setinterval-和-settimeout"><a href="#忘记清除的-setinterval-和-settimeout" class="header-anchor">#</a> 忘记清除的 setInterval 和 setTimeout</h5> <p>我们在实现轮询效果时，会用到 <code>setInterval</code>：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
	<span class="token comment">// 函数体</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者链式调用 <code>setTimeout</code>：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
	<span class="token comment">// 函数体 </span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>callee<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在 <code>setInterval</code> 和链式调用的 <code>setTimeout</code> 这两种场景下，定时器的工作可以说都是无穷无尽的。当定时器囊括的函数逻辑不再被需要、而我们又忘记手动清除定时器时，它们就会永远保持对内存的占用。因此当我们使用定时器时，一定要先问问自己：我打算什么时候干掉这玩意儿？</p> <h5 id="清除不当的-dom"><a href="#清除不当的-dom" class="header-anchor">#</a> 清除不当的 DOM</h5> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> myDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myDiv'</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">handleMyDiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
	<span class="token comment">// 一些与myDiv相关的逻辑</span>
<span class="token punctuation">}</span>
<span class="token comment">// 使用myDiv</span>
<span class="token function">handleMyDiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 尝试”删除“ myDiv</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myDiv'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>有同学以为第 11 行这种写法，就足以对 <code>myDiv</code> 这个 DOM 进行删除。这种想法非常天真，因为 <code>myDiv</code> 这个变量对这个 DOM 的引用仍然存在，它仍然是一块 “可抵达” 的内存。这种你以为已经清除、但其实活得好好的 DOM 一旦堆积，将带来不可预期的内存隐患。</p> <p>这里我们针对内存泄漏成因，分析了以上几点。事实上，能够导致内存泄露的，还有无数种 “骚操作”，它们有一个共同的名字 —— 误操作。</p> <p>没错，内存泄漏其实并不是啥高深的命题，导致内存泄露的，往往是低级错误。说得直接点，那就是代码功夫不到家。因此，各位同学无论处在哪个学习阶段，都应该保持严谨的态度 —— 敬畏手中的键盘、敬畏每一行代码！</p> <h3 id="闭包的应用"><a href="#闭包的应用" class="header-anchor">#</a> 闭包的应用</h3> <blockquote><p>发散问题，可以多想</p></blockquote> <h4 id="答案-7"><a href="#答案-7" class="header-anchor">#</a> 答案</h4> <ol><li><strong>模拟私有变量的实现</strong></li> <li><strong>偏函数和柯里化</strong></li></ol> <h4 id="解析-6"><a href="#解析-6" class="header-anchor">#</a> 解析</h4> <h5 id="_1-模拟私有变量的实现"><a href="#_1-模拟私有变量的实现" class="header-anchor">#</a> 1. 模拟私有变量的实现</h5> <p>利用闭包生成一个 IIFF，把私有变量用函数作用域来保护起来，使外界无法访问私有变量</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 利用闭包生成IIFE，返回 User 类</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义私有变量_password</span>
    <span class="token keyword">let</span> _password

    <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
        <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">username<span class="token punctuation">,</span> password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 初始化私有变量_password</span>
            _password <span class="token operator">=</span> password
            <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username
        <span class="token punctuation">}</span>

       <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// 这里我们增加一行 console，为了验证 login 里仍可以顺利拿到密码</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span> _password<span class="token punctuation">)</span>
           <span class="token comment">// 使用 fetch 进行登录请求，同上，此处省略</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> User
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">'xiuyan'</span><span class="token punctuation">,</span> <span class="token string">'xiuyan123'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token comment">// xiuyan</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>password<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>_password<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
user<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// xiuyan xiuyan123</span>
</code></pre></div><h5 id="_2-柯里化"><a href="#_2-柯里化" class="header-anchor">#</a> 2. 柯里化</h5> <p>在计算机科学中，柯里化（英语：Currying），又译为卡瑞化或加里化，是<strong>把接受多个参数的函数变换成接受一个单一参数（最初函数的第一个参数）的函数</strong>，并且<strong>返回接受余下的参数而且返回结果的新函数的技术</strong></p> <p>柯里化是把接受 n 个参数的 1 个函数改造为只接受 1 个参数的 n 个互相嵌套的函数的过程。也就是 <code>fn (a, b, c)</code> 会变成 <code>fn(a)(b)(c)</code>。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 原始函数</span>
<span class="token keyword">function</span> <span class="token function">generateName</span><span class="token punctuation">(</span><span class="token parameter">prefix<span class="token punctuation">,</span> type<span class="token punctuation">,</span> itemName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> prefix <span class="token operator">+</span> type <span class="token operator">+</span> itemName
<span class="token punctuation">}</span>

<span class="token comment">// 调用时一口气传入3个入参</span>
<span class="token keyword">var</span> itemFullName <span class="token operator">=</span> <span class="token function">generateName</span><span class="token punctuation">(</span><span class="token string">'大卖网'</span><span class="token punctuation">,</span> <span class="token string">'母婴'</span><span class="token punctuation">,</span> <span class="token string">'奶瓶'</span><span class="token punctuation">)</span>

<span class="token comment">// 柯里化后</span>
<span class="token keyword">function</span> <span class="token function">generateName</span><span class="token punctuation">(</span><span class="token parameter">prefix</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">itemName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> prefix <span class="token operator">+</span> type <span class="token operator">+</span> itemName
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 生成大卖网商品名专属函数</span>
<span class="token keyword">var</span> salesName <span class="token operator">=</span> <span class="token function">generateName</span><span class="token punctuation">(</span><span class="token string">'大卖网'</span><span class="token punctuation">)</span>

<span class="token comment">// “记住”prefix，生成大卖网母婴商品名专属函数</span>
<span class="token keyword">var</span> salesBabyName <span class="token operator">=</span> <span class="token function">salesName</span><span class="token punctuation">(</span><span class="token string">'母婴'</span><span class="token punctuation">)</span>

<span class="token comment">// &quot;记住“prefix和type，生成洗菜网生鲜商品名专属函数</span>
<span class="token keyword">var</span> vegFreshName <span class="token operator">=</span> <span class="token function">generateName</span><span class="token punctuation">(</span><span class="token string">'洗菜网'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'生鲜'</span><span class="token punctuation">)</span>

<span class="token comment">// 输出 '大卖网母婴奶瓶'</span>
<span class="token function">salesBabyName</span><span class="token punctuation">(</span><span class="token string">'奶瓶'</span><span class="token punctuation">)</span>
<span class="token comment">// 输出 '洗菜网生鲜菠菜'</span>
<span class="token function">vegFreshName</span><span class="token punctuation">(</span><span class="token string">'菠菜'</span><span class="token punctuation">)</span>

<span class="token comment">// 啥也不记，直接生成一个商品名</span>
<span class="token keyword">var</span> itemFullName <span class="token operator">=</span> <span class="token function">generateName</span><span class="token punctuation">(</span><span class="token string">'洗菜网'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'生鲜'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'菠菜'</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="_3-偏函数"><a href="#_3-偏函数" class="header-anchor">#</a> 3. 偏函数</h5> <p>偏函数是说，固定你函数的某一个或几个参数，然后返回一个新的函数（这个函数用于接收剩下的参数）。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 改造前</span>
<span class="token keyword">function</span> <span class="token function">generateName</span><span class="token punctuation">(</span><span class="token parameter">prefix<span class="token punctuation">,</span> type<span class="token punctuation">,</span> itemName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> prefix <span class="token operator">+</span> type <span class="token operator">+</span> itemName
<span class="token punctuation">}</span>

<span class="token comment">// 调用时一口气传入3个入参</span>
<span class="token keyword">var</span> itemFullName <span class="token operator">=</span> <span class="token function">generateName</span><span class="token punctuation">(</span><span class="token string">'大卖网'</span><span class="token punctuation">,</span> <span class="token string">'母婴'</span><span class="token punctuation">,</span> <span class="token string">'奶瓶'</span><span class="token punctuation">)</span>

<span class="token comment">// 偏函数应用改造，先传 1 个参数，再传 2 个参数</span>
<span class="token keyword">function</span> <span class="token function">generateName</span><span class="token punctuation">(</span><span class="token parameter">prefix</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> itemName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> prefix <span class="token operator">+</span> type <span class="token operator">+</span> itemName
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 把 3 个参数分两部分传入</span>
<span class="token keyword">var</span> itemFullName <span class="token operator">=</span> <span class="token function">generateName</span><span class="token punctuation">(</span><span class="token string">'大卖网'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'母婴'</span><span class="token punctuation">,</span> <span class="token string">'奶瓶'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="代码题-闭包-作用域"><a href="#代码题-闭包-作用域" class="header-anchor">#</a> 代码题：闭包 &amp; 作用域</h3> <blockquote><p>可以画图来梳理作用域，找变量（其实不难，就是看着头疼）</p></blockquote> <h4 id="题目-2"><a href="#题目-2" class="header-anchor">#</a> 题目</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">foo</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">foo</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">var</span> func1<span class="token operator">=</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
func1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
func1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
func1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> func2<span class="token operator">=</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> func3<span class="token operator">=</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
func3<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
func3<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="答案-8"><a href="#答案-8" class="header-anchor">#</a> 答案</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">foo</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">foo</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> func1<span class="token operator">=</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
func1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 0</span>
func1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0</span>
func1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0</span>
<span class="token keyword">var</span> func2<span class="token operator">=</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined 0 1 2</span>
<span class="token keyword">var</span> func3<span class="token operator">=</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined 0</span>
func3<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span>
func3<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre></div><h4 id="解析-7"><a href="#解析-7" class="header-anchor">#</a> 解析</h4> <p><strong>函数调用一次，就会产生一个作用域（闭包）</strong></p> <p>解析如下代码所示：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">var</span> func1<span class="token operator">=</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined ➡️ foo(0, undefined)</span>
func1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 0 ➡️ foo(1,0) </span>
func1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0 ➡️ foo(2,0)</span>
func1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0 ➡️ foo(3,0)</span>
<span class="token keyword">var</span> func2<span class="token operator">=</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined 0 1 2 ➡️ foo(0,undefined) ➡️ foo(1,0) ➡️ foo(2,1) ➡️ foo(3,2)</span>
<span class="token keyword">var</span> func3<span class="token operator">=</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined 0 ➡️ foo(0,undefined) ➡️ foo(1,0)</span>
func3<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1 ➡️ foo(2,1)</span>
func3<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 ➡️ foo(3,1)</span>
</code></pre></div><h3 id="代码题-闭包内存泄漏问题-thething"><a href="#代码题-闭包内存泄漏问题-thething" class="header-anchor">#</a> 代码题：闭包内存泄漏问题 theThing</h3> <p>错误使用闭包造成的内存泄漏问题</p> <h4 id="代码-4"><a href="#代码-4" class="header-anchor">#</a> 代码</h4> <p>下面这段代码有什么问题？</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">var</span> theThing <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">replaceThing</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> originalThing <span class="token operator">=</span> theThing<span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">unused</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>originalThing<span class="token punctuation">)</span> <span class="token comment">// 'originalThing'的引用</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;嘿嘿嘿&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  theThing <span class="token operator">=</span> <span class="token punctuation">{</span>
    longStr<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">someMethod</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;哈哈哈&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span>replaceThing<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="答案-9"><a href="#答案-9" class="header-anchor">#</a> 答案</h4> <p>⚠️ <strong>严重的内存泄漏</strong></p> <p>要想揪出其中的问题，大家需要对 V8 引擎有所了解，尤其是这一点：<strong>在 V8 中，一旦不同的作用域位于同一个父级作用域下，那么它们会共享这个父级作用域。</strong></p> <ol><li>在这段代码里， <code>unused</code> 是一个不会被使用的闭包，但和它共享同一个父级作用域的 <code>someMethod</code>，则是一个 “可抵达”（也就意味着可以被使用）的闭包。</li> <li><code>unused</code> 引用了 <code>originalThing</code>，这导致和它共享作用域的 <code>someMethod</code> 也间接地引用了 <code>originalThing</code>。结果就是 <code>someMethod</code> “被迫” 产生了对 <code>originalThing</code> 的持续引用，<code>originalThing</code> 虽然没有任何意义和作用，却永远不会被回收。</li> <li>不仅如此，<code>originalThing</code> 每次 <code>setInterval</code> 都会改变一次指向（指向最近一次的 <code>theThing</code> 赋值结果），这导致无法被回收的无用 <code>originalThing</code> 越堆积越多，最终导致严重的内存泄漏。</li></ol> <h3 id="闭包经典问题-循环与闭包"><a href="#闭包经典问题-循环与闭包" class="header-anchor">#</a> 闭包经典问题：循环与闭包</h3> <p>“循环体与闭包”系列</p> <h4 id="题目-3"><a href="#题目-3" class="header-anchor">#</a> 题目</h4> <p>以下代码输出了什么</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="答案-10"><a href="#答案-10" class="header-anchor">#</a> 答案</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token number">5</span> <span class="token number">5</span> <span class="token number">5</span> <span class="token number">5</span> <span class="token number">5</span> <span class="token number">5</span>
</code></pre></div><h4 id="解析-8"><a href="#解析-8" class="header-anchor">#</a> 解析</h4> <ol><li><code>for</code> 循环分别在 i = 0-4 的时候添加了5个 <code>setTimeout</code> 定时任务</li> <li>循环完成，此时 i = 5，代码 <code>console.log(i)</code> 输出第一个 <code>5</code></li> <li>同步任务执行完成，开始执行异步任务，，其内部没有<code>i</code>变量，故从全局作用域中获取，连续输出 5 个 <code>5</code></li></ol> <h4 id="举一反三-改造使得到顺序输出"><a href="#举一反三-改造使得到顺序输出" class="header-anchor">#</a> 举一反三：改造使得到顺序输出</h4> <h5 id="_1-settimeout-的第三个参数"><a href="#_1-settimeout-的第三个参数" class="header-anchor">#</a> 1.setTimeout 的第三个参数</h5> <p>我们可以把 <code>setTimeout</code> 函数的第三个参数利用起来。别忘了，<code>setTimeout</code> 从第三个入参位置开始往后，是可以传入无数个参数的。这些参数会作为回调函数的附加参数存在。</p> <p>在这里我们可以把每一轮循环里 <code>i</code> 的值，存进 <code>setTimout</code> 的第三个参数里：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_2-闭包-外面套一层函数"><a href="#_2-闭包-外面套一层函数" class="header-anchor">#</a> <strong>2. 闭包：外面套一层函数</strong></h5> <p>在 <code>setTimeout</code> 外面再套一层函数，利用这个外部函数的入参来缓存每一个循环中的 i 值：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">var</span> <span class="token function-variable function">output</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里的 i 被赋值给了 output 作用域内的变量 i</span>
    <span class="token function">output</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_3-闭包-外面套立即执行函数"><a href="#_3-闭包-外面套立即执行函数" class="header-anchor">#</a> 3. 闭包：外面套立即执行函数</h5> <p>和第二种思路比较相似，同样是在 <code>setTimeout</code> 外面再套一层函数，只不过这个函数是一个立即执行函数。利用立即执行函数的入参来缓存每一个循环中的 <code>i</code> 值：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里的 i 被赋值给了立即执行函数作用域内的变量 j</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="代码题-声明"><a href="#代码题-声明" class="header-anchor">#</a> 代码题：声明</h3> <blockquote><p>函数声明优先级 &gt; 变量声明</p></blockquote> <h4 id="代码-5"><a href="#代码-5" class="header-anchor">#</a> 代码</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="答案-11"><a href="#答案-11" class="header-anchor">#</a> 答案</h4> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="解析-9"><a href="#解析-9" class="header-anchor">#</a> 解析</h4> <ol><li>函数表达式与函数声明不同，函数名只在该函数内部有效，并且此绑定是常量绑定。</li> <li>对于一个常量进行赋值（类似 <code>const</code> 或函数声明），在 strict 模式下会报错，非 strict 模式下静默失败。</li> <li>IIFE 中的函数是函数表达式，而不是函数声明。</li></ol> <p>几个例子：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 内部作用域，会先去查找是有已有变量b的声明，有就直接赋值20，确实有了呀。发现了具名函数 function b(){}，拿此b做赋值；</span>
   <span class="token comment">// IIFE的函数无法进行赋值（内部机制，类似const定义的常量），所以无效。</span>
  <span class="token comment">// （这里说的“内部机制”，想搞清楚，需要去查阅一些资料，弄明白IIFE在JS引擎的工作方式，堆栈存储IIFE的方式等）</span>
    b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Function b]</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10，不是20</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>所以严格模式下能看到错误：<code>Uncaught TypeError: Assignment to constant variable</code></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use strict'</span>
  b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;Uncaught TypeError: Assignment to constant variable.&quot;</span>
</code></pre></div><p>其他情况例子：</p> <p>有<code>window</code>：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Function b]</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20是必然的</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>有<code>var</code>:</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// IIFE内部变量</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10 </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="代码题-this"><a href="#代码题-this" class="header-anchor">#</a> 代码题：this</h3> <h4 id="代码-6"><a href="#代码-6" class="header-anchor">#</a> 代码</h4> <p>以下两次函数调用的输出结果是什么？为什么？</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token function-variable function">func2</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token function-variable function">func3</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// func1</span>
<span class="token keyword">var</span> <span class="token function-variable function">func1</span>  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// func2</span>
<span class="token keyword">var</span> func2 <span class="token operator">=</span> obj<span class="token punctuation">.</span>func2
<span class="token comment">// func3</span>
<span class="token keyword">var</span> func3 <span class="token operator">=</span> obj<span class="token punctuation">.</span>func3

<span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">func3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span><span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span><span class="token function">func3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="答案-12"><a href="#答案-12" class="header-anchor">#</a> 答案</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token number">1</span>
<span class="token number">1</span>
<span class="token number">1</span>
<span class="token number">1</span>
<span class="token number">2</span>
</code></pre></div><h2 id="js-api-相关"><a href="#js-api-相关" class="header-anchor">#</a> JS API 相关</h2> <h3 id="数组去重的方法"><a href="#数组去重的方法" class="header-anchor">#</a> 数组去重的方法</h3> <ol><li>利用 ES6 Set 去重，<code>[...new Set(arr)]</code></li> <li>利用 <code>for</code> 嵌套 <code>for</code>，然后 <code>splice</code> 去重</li> <li>利用 <code>indexOf</code> 去重</li></ol></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.092652d7.js" defer></script><script src="/assets/js/3.0170136f.js" defer></script><script src="/assets/js/1.47899070.js" defer></script><script src="/assets/js/18.b056b744.js" defer></script>
  </body>
</html>
